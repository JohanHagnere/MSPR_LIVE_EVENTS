{% extends 'base.html.twig' %} {% block title %}Carte du festival{% endblock %}
{% block body %}
<style>
  #map_festival {
    height: 100%;
    width: 100%;
  }
</style>
<div id="map_festival"></div>

<script>
  const markers = JSON.parse("{{ markers | e('js') }}");

  function initMap() {
    const festival = { lat: 44.86536609557045, lng: -0.5603782196036978 };

    // Création de la carte
    const map = new google.maps.Map(document.getElementById("map_festival"), {
      zoom: 15,
      center: festival,
      styles: [
        {
          featureType: "poi", // Points of interest
          stylers: [{ visibility: "off" }] // les masquer
        },
        {
          featureType: "transit", // Transports en commun
          stylers: [{ visibility: "off" }] // les masquer
        },
      ]
      
    });

    // Récupération de la position de l'utilisateur
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        function (position) {
          const userLatLng = {
            lat: position.coords.latitude,
            lng: position.coords.longitude,
          };

          // Ajout du marqueur pour la position de l'utilisateur
          const userMarker = new google.maps.Marker({
            position: userLatLng,
            map,
            title: "Votre position",
            icon: {
              url: "{{ asset('icons/user-marker.svg') }}",
              scaledSize: new google.maps.Size(38, 38),
            },
          });

          // Centrage de la carte sur la position de l'utilisateur
          map.setCenter(userLatLng);
        },
        function (error) {
          console.error("Erreur de géolocalisation :", error);
        }
      );
    } else {
      console.error(
        "La géolocalisation n'est pas prise en charge par votre navigateur."
      );
    }

    // Ajout des marqueurs du festival
    for (var i = 0; i < markers.length; i++) {
      const marker = new google.maps.Marker({
        position: { lat: markers[i].latitude, lng: markers[i].longitude },
        map,
        title: markers[i].name,
        icon: {
          url: markers[i].img,
          scaledSize: new google.maps.Size(38, 23),
        },
      });
    }
  }

  window.initMap = initMap;
</script>
<script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDfh6E4gClmwOAfjx9hD9WrzmRWNWff1ko&callback=initMap&v=weekly"
  defer
></script>
{% endblock %}
